require 'technical-analysis'
require 'spec_helper'

describe 'Indicators' do
  describe "WR" do
    input_data = SpecHelper.get_test_data(:high, :low, :close)

    describe 'Williams %R' do
      it 'Calculates Williams %R' do
        output = TechnicalAnalysis::Wr.calculate(input_data, period: 14)

        expected_output = [
          {:date=>"2018/10/26", :value=>-73.3779264214046},
          {:date=>"2018/10/29", :value=>-69.64461994076994},
          {:date=>"2018/10/30", :value=>-60.253583241455274},
          {:date=>"2018/10/31", :value=>-29.60308710033065},
          {:date=>"2018/11/01", :value=>-11.080485115766221},
          {:date=>"2018/11/02", :value=>-89.09574468085114},
          {:date=>"2018/11/05", :value=>-86.87643898695312},
          {:date=>"2018/11/06", :value=>-78.51112816577121},
          {:date=>"2018/11/07", :value=>-54.79662317728319},
          {:date=>"2018/11/08", :value=>-60.39907904834988},
          {:date=>"2018/11/09", :value=>-75.82501918649267},
          {:date=>"2018/11/12", :value=>-98.75164257555849},
          {:date=>"2018/11/13", :value=>-97.47686016454276},
          {:date=>"2018/11/14", :value=>-97.61185835849572},
          {:date=>"2018/11/15", :value=>-84.95745264891575},
          {:date=>"2018/11/16", :value=>-79.13807301674446},
          {:date=>"2018/11/19", :value=>-97.67192935509766},
          {:date=>"2018/11/20", :value=>-96.8623265741729},
          {:date=>"2018/11/21", :value=>-96.67016255899316},
          {:date=>"2018/11/23", :value=>-99.50026301946345},
          {:date=>"2018/11/26", :value=>-89.06171600602104},
          {:date=>"2018/11/27", :value=>-90.01505268439534},
          {:date=>"2018/11/28", :value=>-73.20622177621675},
          {:date=>"2018/11/29", :value=>-74.01398601398596},
          {:date=>"2018/11/30", :value=>-71.8823927002365},
          {:date=>"2018/12/03", :value=>-45.9138187221397},
          {:date=>"2018/12/04", :value=>-73.97761994374633},
          {:date=>"2018/12/06", :value=>-81.95026204496244},
          {:date=>"2018/12/07", :value=>-99.28757569508241},
          {:date=>"2018/12/10", :value=>-77.09170624771653},
          {:date=>"2018/12/11", :value=>-75.47431744562708},
          {:date=>"2018/12/12", :value=>-73.29939842665439},
          {:date=>"2018/12/13", :value=>-64.73854696899592},
          {:date=>"2018/12/14", :value=>-90.0509023600186},
          {:date=>"2018/12/17", :value=>-94.55200360198106},
          {:date=>"2018/12/18", :value=>-84.961728950923},
          {:date=>"2018/12/19", :value=>-93.03675048355906},
          {:date=>"2018/12/20", :value=>-94.83805668016194},
          {:date=>"2018/12/21", :value=>-96.88473520249222},
          {:date=>"2018/12/24", :value=>-99.32960706594149},
          {:date=>"2018/12/26", :value=>-62.468960624334926},
          {:date=>"2018/12/27", :value=>-65.7347670250896},
          {:date=>"2018/12/28", :value=>-62.8945342571209},
          {:date=>"2018/12/31", :value=>-57.082371054657386},
          {:date=>"2019/01/02", :value=>-56.38953040800621},
          {:date=>"2019/01/03", :value=>-99.37847562970234},
          {:date=>"2019/01/04", :value=>-76.88330871491881},
          {:date=>"2019/01/07", :value=>-77.4952561669829},
          {:date=>"2019/01/08", :value=>-65.72659616137877},
          {:date=>"2019/01/09", :value=>-55.55992141453828}
        ]

        expect(output).to eq(expected_output)
      end

      it "Throws exception if not enough data" do
        expect {TechnicalAnalysis::Wr.calculate(input_data, period: input_data.size+1)}.to raise_exception(Validation::ValidationError)
      end
    end
  end
end
